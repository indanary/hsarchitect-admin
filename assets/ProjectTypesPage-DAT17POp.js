import{a as M,r as d,v as A,j as w,o as _,w as a,x as b,h as i,e,n as g,k as q,m as r,Q as R,t as P,y as x}from"./index--h6_vfO-.js";import{Q as T}from"./QInput-CsRd1fYR.js";import{u as G,Q as H}from"./use-quasar-X6Lp6m-T.js";import{Q as J,a as D,b as S,c as K,d as N,e as O,C as Q,f as I}from"./ClosePopup-Ci_hn4yl.js";import{Q as C}from"./QCard-DMtk_vtU.js";import{Q as h}from"./uid-BrPC7ZYM.js";import{Q as W}from"./QSeparator-M0rqPBTW.js";import{Q as X}from"./QForm-DBtyPbqv.js";import{Q as Y}from"./QPage-DHSi9zRF.js";const Z={class:"row items-center justify-between q-mb-md"},ee={class:"row items-center q-gutter-sm"},te={class:"text-h6"},ce=M({__name:"ProjectTypesPage",setup(ae){const c=G(),s=d(!0),V=d([]),f=d(""),E=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"project_type",label:"Project Type",field:"project_type",align:"left",sortable:!0},{name:"actions",label:"",field:"actions",align:"right"}];async function m(o=!1){o||(s.value=!0);try{const{data:t}=await b.get("/project-types",{params:f.value?{q:f.value}:void 0});V.value=t}catch(t){j(t,"Failed to load project types")}finally{o||(s.value=!1)}}function U(){f.value="",m()}const n=d({open:!1,mode:"create",editingId:null}),u=d({project_type:""}),p=d(!1);function $(){n.value={open:!0,mode:"create",editingId:null},u.value={project_type:""}}function B(o){n.value={open:!0,mode:"edit",editingId:o.id},u.value={project_type:o.project_type}}async function k(){if(!u.value.project_type?.trim()){c.notify({type:"warning",message:"Project type is required"});return}p.value=!0;try{n.value.mode==="create"?(await b.post("/project-types",{project_type:u.value.project_type.trim()}),c.notify({type:"positive",message:"Created"})):(await b.patch(`/project-types/${n.value.editingId}`,{project_type:u.value.project_type.trim()}),c.notify({type:"positive",message:"Saved"})),n.value.open=!1,await m()}catch(o){o?.response?.status===409?c.notify({type:"negative",message:"That project type already exists"}):j(o,"Failed to save")}finally{p.value=!1}}const y=d({open:!1,id:null}),v=d(!1);function F(o){y.value={open:!0,id:o.id}}async function z(){v.value=!0;try{await b.delete(`/project-types/${y.value.id}`),c.notify({type:"positive",message:"Deleted"}),y.value.open=!1,await m()}catch(o){j(o,"Failed to delete")}finally{v.value=!1}}function j(o,t="Error"){const l=o?.response?.data?.error||o?.message||t;c.notify({type:"negative",message:l})}return A(async()=>{try{await m(!0)}finally{s.value=!1}}),(o,t)=>(_(),w(Y,{padding:"",class:"column q-gutter-lg","aria-busy":s.value},{default:a(()=>[t[9]||(t[9]=i("div",{class:"q-pa-sm q-mt-xs bg-yellow-2 text-yellow-9 rounded-borders text-body2"},[g(" ⚠️ Updates may take a few minutes to appear on "),i("strong",null,"hsarchitect.id"),g(" after saving. ")],-1)),i("div",Z,[t[5]||(t[5]=i("div",{class:"column"},[i("div",{class:"text-h5 text-weight-bold"},"Project Types"),i("div",{class:"text-caption text-grey-7"}," Define and manage categories for your projects ")],-1)),i("div",ee,[e(T,{modelValue:f.value,"onUpdate:modelValue":[t[0]||(t[0]=l=>f.value=l),t[1]||(t[1]=()=>m())],dense:"",outlined:"",debounce:"300",placeholder:"Search project types…",style:{width:"260px"},disable:s.value},{prepend:a(()=>[e(R,{name:"search"})]),append:a(()=>[f.value?(_(),w(r,{key:0,flat:"",round:"",dense:"",icon:"close",onClick:U,disable:s.value},null,8,["disable"])):q("",!0)]),_:1},8,["modelValue","disable"]),e(r,{color:"primary",icon:"add",label:"New Type",unelevated:"",onClick:$,disable:s.value},null,8,["disable"])])]),e(C,{flat:"",bordered:""},{default:a(()=>[s.value?(_(),w(H,{key:0,indeterminate:"",class:"q-mb-xs"})):q("",!0),e(J,{rows:V.value,columns:E,"row-key":"id",flat:"",loading:s.value,pagination:{rowsPerPage:0},separator:"horizontal","no-data-label":"No project types yet","no-results-label":"No matches"},{"body-cell-project_type":a(l=>[e(D,{props:l},{default:a(()=>[e(K,{dense:"",square:"",color:"grey-3","text-color":"grey-9",class:"text-capitalize"},{default:a(()=>[g(P(l.row.project_type),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-actions":a(l=>[e(D,{props:l,class:"q-gutter-xs text-right"},{default:a(()=>[e(r,{dense:"",flat:"",round:"",icon:"edit",color:"primary",onClick:L=>B(l.row),disable:s.value},{default:a(()=>[e(S,null,{default:a(()=>[...t[6]||(t[6]=[g("Edit",-1)])]),_:1})]),_:1},8,["onClick","disable"]),e(r,{dense:"",flat:"",round:"",icon:"delete",color:"negative",onClick:L=>F(l.row),disable:s.value},{default:a(()=>[e(S,null,{default:a(()=>[...t[7]||(t[7]=[g("Delete",-1)])]),_:1})]),_:1},8,["onClick","disable"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),e(N,{modelValue:n.value.open,"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.open=l),persistent:""},{default:a(()=>[e(C,{style:{"min-width":"420px","max-width":"90vw"}},{default:a(()=>[e(h,{class:"row items-center"},{default:a(()=>[i("div",te,P(n.value.mode==="create"?"New Project Type":"Edit Project Type"),1),e(O),x(e(r,{icon:"close",flat:"",round:"",dense:"",disable:p.value},null,8,["disable"]),[[Q]])]),_:1}),e(W),e(h,null,{default:a(()=>[e(X,{onSubmit:k},{default:a(()=>[e(T,{modelValue:u.value.project_type,"onUpdate:modelValue":t[2]||(t[2]=l=>u.value.project_type=l),label:"Project type *",outlined:"",rules:[l=>!!l&&l.trim().length>0||"Required",l=>(l?.length??0)<=120||"Max 120 chars"],autofocus:"",disable:p.value},null,8,["modelValue","rules","disable"])]),_:1})]),_:1}),e(I,{align:"right"},{default:a(()=>[x(e(r,{flat:"",label:"Cancel",disable:p.value},null,8,["disable"]),[[Q]]),e(r,{color:"primary",loading:p.value,label:n.value.mode==="create"?"Create":"Save",onClick:k,disable:p.value},null,8,["loading","label","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(N,{modelValue:y.value.open,"onUpdate:modelValue":t[4]||(t[4]=l=>y.value.open=l)},{default:a(()=>[e(C,null,{default:a(()=>[e(h,null,{default:a(()=>[...t[8]||(t[8]=[i("div",{class:"text-h6"},"Delete project type?",-1),i("div",{class:"text-body2 q-mt-xs"},"This action cannot be undone.",-1)])]),_:1}),e(I,{align:"right"},{default:a(()=>[x(e(r,{flat:"",label:"Cancel",disable:v.value},null,8,["disable"]),[[Q]]),e(r,{color:"negative",label:"Delete",loading:v.value,onClick:z,disable:v.value},null,8,["loading","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["aria-busy"]))}});export{ce as default};
