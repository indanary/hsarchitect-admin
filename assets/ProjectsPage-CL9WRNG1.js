import{d as X,H as x,I as J,r as w,J as Z,h as z,o as $,w as g,a as t,g as v,G as ee,t as O,E as te,Q as C,D as Q,m as ne,K as me,s as se,L as fe,v as U,x as re,M as ie,N as pe,q as de,T as ge,O as K,y as Y,i as L,k as A,c as E,P as ve,R as ye,F as be}from"./index-DDweDHnI.js";import{a as R,b as D,Q as H}from"./QCard-DSim-vQw.js";import{b as le,C as ae,d as he,c as ue,e as we,Q as _e,a as G}from"./ClosePopup-D82EvVQ4.js";import{Q as je}from"./QPage-Bi2UGTBq.js";import{u as oe,Q as W}from"./use-quasar-DC3yOtG6.js";import{Q as Se}from"./QEditor-D2Gy8QFV.js";import{Q as Ve}from"./QBanner-B8ayu7SO.js";import"./focus-manager-DnPWlgXC.js";const ke={class:"text-h6"},Ce={class:"column q-gutter-md"},qe=X({__name:"ProjectEditor",props:{modelValue:{type:Boolean},mode:{},projectId:{},typeOptions:{}},emits:["update:modelValue","saved"],setup(l,{emit:S}){const i=l,_=S,y=oe(),q=x({get:()=>i.modelValue,set:o=>_("update:modelValue",o)}),e=J({id:0,title:"",location:"",description:"",project_type_id:null,scope:"",year:null,status:"",area:""}),d=w(!1);function I(o){e.id=o.id??0,e.title=o.title??"",e.location=o.location??"",e.description=o.description??"",e.project_type_id=o.project_type_id??null,e.scope=o.scope??"",e.year=Number.isFinite(o.year)?o.year:null,e.status=o.status??"",e.area=o.area??""}async function V(){if(i.projectId)try{const{data:o}=await Q.get(`/projects/admin/${i.projectId}`);I(o)}catch(o){k(o,"Failed to load project")}}function b(){I({})}function N(){q.value=!1}async function h(){if(!e.title?.trim()){y.notify({type:"warning",message:"Title is required"});return}d.value=!0;try{if(i.mode==="create"){const{data:o}=await Q.post("/projects/admin",{title:e.title,location:e.location||null,description:e.description||"",project_type_id:e.project_type_id,scope:e.scope||null,year:e.year??null,status:e.status,area:e.area||null});_("saved",o.id)}else await Q.patch(`/projects/admin/${i.projectId}`,{title:e.title,location:e.location||null,description:e.description||"",project_type_id:e.project_type_id,scope:e.scope||null,year:e.year??null,status:e.status,area:e.area||null}),_("saved",i.projectId);N(),y.notify({type:"positive",message:"Saved"})}catch(o){k(o,"Failed to save")}finally{d.value=!1}}function k(o,n="Error"){const s=o?.response?.data?.error||o?.message||n;y.notify({type:"negative",message:s})}return Z(()=>i.modelValue,async o=>{o&&(i.mode==="edit"&&i.projectId?await V():b())}),(o,n)=>($(),z(le,{modelValue:q.value,"onUpdate:modelValue":n[8]||(n[8]=s=>q.value=s),persistent:""},{default:g(()=>[t(H,{style:{"min-width":"720px","max-width":"95vw"}},{default:g(()=>[t(R,{class:"row items-center"},{default:g(()=>[v("div",ke,O(l.mode==="create"?"New Project":"Edit Project"),1),t(te),ee(t(C,{flat:"",round:"",dense:"",icon:"close"},null,512),[[ae]])]),_:1}),t(W),t(R,{style:{"max-height":"70vh","overflow-y":"auto"}},{default:g(()=>[v("div",Ce,[t(D,{modelValue:e.title,"onUpdate:modelValue":n[0]||(n[0]=s=>e.title=s),label:"Title *",outlined:"",disable:d.value,rules:[s=>!!s&&s.trim().length>0||"Required"],autofocus:""},null,8,["modelValue","disable","rules"]),t(D,{modelValue:e.location,"onUpdate:modelValue":n[1]||(n[1]=s=>e.location=s),label:"Location",outlined:"",disable:d.value},null,8,["modelValue","disable"]),t(he,{modelValue:e.project_type_id,"onUpdate:modelValue":n[2]||(n[2]=s=>e.project_type_id=s),options:l.typeOptions,"option-value":"id","option-label":"project_type","emit-value":"","map-options":"",outlined:"",clearable:"","use-input":!1,label:"Project Type",disable:d.value},null,8,["modelValue","options","disable"]),t(D,{modelValue:e.scope,"onUpdate:modelValue":n[3]||(n[3]=s=>e.scope=s),label:"Scope",outlined:"",disable:d.value},null,8,["modelValue","disable"]),t(D,{modelValue:e.year,"onUpdate:modelValue":n[4]||(n[4]=s=>e.year=s),modelModifiers:{number:!0},type:"number",label:"Year",outlined:"",disable:d.value},null,8,["modelValue","disable"]),t(D,{modelValue:e.status,"onUpdate:modelValue":n[5]||(n[5]=s=>e.status=s),label:"Status",outlined:"",disable:d.value},null,8,["modelValue","disable"]),t(D,{modelValue:e.area,"onUpdate:modelValue":n[6]||(n[6]=s=>e.area=s),label:"Area (e.g. 350 mÂ²)",outlined:"",disable:d.value},null,8,["modelValue","disable"]),v("div",null,[n[9]||(n[9]=v("div",{class:"text-subtitle2 q-mb-xs"},"Description (HTML)",-1)),t(Se,{modelValue:e.description,"onUpdate:modelValue":n[7]||(n[7]=s=>e.description=s),"min-height":"200px",readonly:d.value,toolbar:[["bold","italic","strike","underline"],["quote","unordered","ordered","outdent","indent"],["link","hr"],["undo","redo"],["removeFormat"]]},null,8,["modelValue","readonly"])])])]),_:1}),t(W),t(ue,{align:"right"},{default:g(()=>[t(C,{flat:"",label:"Cancel",disable:d.value,onClick:N},null,8,["disable"]),t(C,{color:"primary",loading:d.value,label:l.mode==="create"?"Create":"Save",onClick:h},null,8,["loading","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ie=ne({name:"QBar",props:{...me,dense:Boolean},setup(l,{slots:S}){const{proxy:{$q:i}}=se(),_=fe(l,i),y=x(()=>`q-bar row no-wrap items-center q-bar--${l.dense===!0?"dense":"standard"}  q-bar--${_.value===!0?"dark":"light"}`);return()=>U("div",{class:y.value,role:"toolbar"},re(S.default))}}),$e={ratio:[String,Number]};function xe(l,S){return x(()=>{const i=Number(l.ratio||(S!==void 0?S.value:void 0));return isNaN(i)!==!0&&i>0?{paddingBottom:`${100/i}%`}:null})}const Qe=1.7778,Te=ne({name:"QImg",props:{...$e,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:Qe},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(l,{slots:S,emit:i}){const _=w(l.initialRatio),y=xe(l,_),q=se(),{registerTimeout:e,removeTimeout:d}=ie(),{registerTimeout:I,removeTimeout:V}=ie(),b=x(()=>l.placeholderSrc!==void 0?{src:l.placeholderSrc}:null),N=x(()=>l.errorSrc!==void 0?{src:l.errorSrc,__qerror:!0}:null),h=[w(null),w(b.value)],k=w(0),o=w(!1),n=w(!1),s=x(()=>`q-img q-img--${l.noNativeMenu===!0?"no-":""}menu`),F=x(()=>({width:l.width,height:l.height})),r=x(()=>`q-img__image ${l.imgClass!==void 0?l.imgClass+" ":""}q-img__image--with${l.noTransition===!0?"out":""}-transition q-img__image--`),a=x(()=>({...l.imgStyle,objectFit:l.fit,objectPosition:l.position}));function m(){if(V(),l.loadingShowDelay===0){o.value=!0;return}I(()=>{o.value=!0},l.loadingShowDelay)}function j(){V(),o.value=!1}function T({target:u}){Y(q)===!1&&(d(),_.value=u.naturalHeight===0?.5:u.naturalWidth/u.naturalHeight,f(u,1))}function f(u,P){P===1e3||Y(q)===!0||(u.complete===!0?p(u):e(()=>{f(u,P+1)},50))}function p(u){Y(q)!==!0&&(k.value=k.value^1,h[k.value].value=null,j(),u.getAttribute("__qerror")!=="true"&&(n.value=!1),i("load",u.currentSrc||u.src))}function c(u){d(),j(),n.value=!0,h[k.value].value=N.value,h[k.value^1].value=b.value,i("error",u)}function B(u){const P=h[u].value,M={key:"img_"+u,class:r.value,style:a.value,alt:l.alt,crossorigin:l.crossorigin,decoding:l.decoding,referrerpolicy:l.referrerpolicy,height:l.height,width:l.width,loading:l.loading,fetchpriority:l.fetchpriority,"aria-hidden":"true",draggable:l.draggable,...P};return k.value===u?Object.assign(M,{class:M.class+"current",onLoad:T,onError:c}):M.class+="loaded",U("div",{class:"q-img__container absolute-full",key:"img"+u},U("img",M))}function ce(){return o.value===!1?U("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},re(S[n.value===!0?"error":"default"])):U("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},S.loading!==void 0?S.loading():l.noSpinner===!0?void 0:[U(K,{color:l.spinnerColor,size:l.spinnerSize})])}{let u=function(){Z(()=>l.src||l.srcset||l.sizes?{src:l.src,srcset:l.srcset,sizes:l.sizes}:null,P=>{d(),n.value=!1,P===null?(j(),h[k.value^1].value=b.value):m(),h[k.value].value=P},{immediate:!0})};pe.value===!0?de(u):u()}return()=>{const u=[];return y.value!==null&&u.push(U("div",{key:"filler",style:y.value})),h[0].value!==null&&u.push(B(0)),h[1].value!==null&&u.push(B(1)),u.push(U(ge,{name:"q-transition--fade"},ce)),U("div",{key:"main",class:s.value,style:F.value,role:"img","aria-label":l.alt},u)}}}),Ue={class:"text-subtitle1"},De={class:"row q-col-gutter-md items-center"},Ne={class:"col-grow"},Pe=["disabled"],Fe={class:"col-auto row items-center q-gutter-sm"},Be={key:0,class:"row items-center q-gutter-xs"},Ee={class:"row q-col-gutter-md"},Le={key:0,class:"col-12"},ze={class:"row q-gutter-sm"},Re={key:1,class:"col-12"},Me=X({__name:"ProjectImagesManager",props:{modelValue:{type:Boolean},projectId:{},projectTitle:{}},emits:["update:modelValue","changed"],setup(l,{emit:S}){const i=l,_=S,y=oe(),q=x({get:()=>i.modelValue,set:r=>_("update:modelValue",r)}),e=w(!1),d=w(!1),I=w([]),V=w(),b="https://hsarchitect-be.onrender.com";function N(r){return r?/^https?:\/\//i.test(r)?r:`${b.replace(/\/$/,"")}${r}`:""}async function h(){if(i.projectId){e.value=!0;try{const{data:r}=await Q.get(`/projects/admin/${i.projectId}`);I.value=(r.images||[]).map(a=>({...a,file_path:N(a.file_path),file_url:a.file_url,alt:a.alt??""}))}catch(r){s(r,"Failed to load images")}finally{e.value=!1}}}async function k(r){const a=r.target;if(!a.files||!i.projectId)return;const m=Array.from(a.files);if(m.length>3){y.notify({type:"warning",message:"You can upload at most 3 images at a time."}),a.value="";return}const j=new FormData;m.forEach(T=>j.append("files",T));try{d.value=!0,await Q.post(`/projects/admin/${i.projectId}/images`,j,{headers:{"Content-Type":"multipart/form-data"}}),y.notify({type:"positive",message:"Uploaded"}),a.value="",await h(),_("changed")}catch(T){s(T,"Upload failed")}finally{d.value=!1}}async function o(r){if(i.projectId)try{await Q.patch(`/projects/admin/${i.projectId}/images/${r.id}`,{alt:(r.alt??"")||null,sort_order:Number.isFinite(r.sort_order)?r.sort_order:0}),y.notify({type:"positive",message:"Saved"}),await h(),_("changed")}catch(a){s(a,"Failed to save meta")}}async function n(r){if(i.projectId)try{await Q.delete(`/projects/admin/${i.projectId}/images/${r.id}`),y.notify({type:"positive",message:"Deleted"}),await h(),_("changed")}catch(a){s(a,"Failed to delete image")}}function s(r,a="Error"){const m=r?.response?.data?.error||r?.message||a;y.notify({type:"negative",message:m})}function F(r,a){const m=Number(a);!Number.isFinite(m)||m<1?(r.sort_order=1,y.notify({type:"warning",message:"Sort order must be at least 1."})):r.sort_order=m}return Z(()=>i.modelValue,async r=>{r?await h():(I.value=[],V.value&&(V.value.value=""))}),(r,a)=>($(),z(le,{modelValue:q.value,"onUpdate:modelValue":a[0]||(a[0]=m=>q.value=m),persistent:"",maximized:""},{default:g(()=>[t(H,null,{default:g(()=>[t(Ie,{class:"bg-grey-2"},{default:g(()=>[v("div",Ue," Images â Project "+O(l.projectTitle??"â"),1),t(te),ee(t(C,{flat:"",dense:"",icon:"close",disable:d.value},null,8,["disable"]),[[ae]])]),_:1}),d.value?($(),z(we,{key:0,indeterminate:"",color:"primary",class:"q-mb-none"})):L("",!0),t(R,{class:"q-pt-md"},{default:g(()=>[v("div",De,[v("div",Ne,[v("input",{ref_key:"fileInput",ref:V,type:"file",multiple:"",accept:"image/*",disabled:e.value||d.value,onChange:k},null,40,Pe),a[1]||(a[1]=v("div",{class:"text-caption text-grey-7 q-mt-xs"},[A(" Select up to "),v("b",null,"3"),A(" images. Theyâll upload immediately. ")],-1))]),v("div",Fe,[d.value?($(),E("div",Be,[t(K,{size:"sm"}),a[2]||(a[2]=v("span",{class:"text-caption"},"Uploadingâ¦",-1))])):L("",!0),t(C,{outline:"",icon:"refresh",label:"Refresh",loading:e.value,disable:d.value,onClick:h},null,8,["loading","disable"])])]),t(W,{class:"q-my-md"}),v("div",Ee,[e.value?($(),E("div",Le,[t(K,{size:"md"})])):L("",!0),($(!0),E(ye,null,ve(I.value,m=>($(),E("div",{key:m.id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[t(H,{bordered:""},{default:g(()=>[t(Te,{src:m.file_url,ratio:4/3,alt:m.alt||"image"},null,8,["src","alt"]),t(R,{class:"q-gutter-sm"},{default:g(()=>[t(D,{modelValue:m.alt,"onUpdate:modelValue":j=>m.alt=j,dense:"",outlined:"",label:"Alt text",disable:d.value||e.value},null,8,["modelValue","onUpdate:modelValue","disable"]),t(D,{modelValue:m.sort_order,"onUpdate:modelValue":[j=>m.sort_order=j,j=>F(m,j)],modelModifiers:{number:!0},dense:"",outlined:"",type:"number",label:"Sort order",disable:d.value||e.value,min:1},null,8,["modelValue","onUpdate:modelValue","disable"]),v("div",ze,[t(C,{dense:"",color:"primary",icon:"save",label:"Save",disable:d.value||e.value,onClick:j=>o(m)},null,8,["disable","onClick"]),t(C,{dense:"",color:"negative",flat:"",icon:"delete",label:"Delete",disable:d.value||e.value,onClick:j=>n(m)},null,8,["disable","onClick"])])]),_:2},1024)]),_:2},1024)]))),128)),!e.value&&I.value.length===0?($(),E("div",Re,[t(Ve,{dense:"",class:"bg-grey-2"},{default:g(()=>[...a[3]||(a[3]=[A(" No images yet. Use the file picker above to upload. ",-1)])]),_:1})])):L("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ae={class:"row items-center q-mb-md"},Ze=X({__name:"ProjectsPage",setup(l){const S=oe(),i=w(""),_=w(!1),y=w([]),q=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0,style:"width: 70px"},{name:"title",label:"Title",field:"title",align:"left",sortable:!0},{name:"project_type",label:"Type",field:"project_type_id",align:"left"},{name:"year",label:"Year",field:"year",align:"left",sortable:!0,style:"width: 90px"},{name:"status",label:"Status",field:"status",align:"left",style:"width: 120px"},{name:"actions",label:"",field:"actions",align:"right",style:"width: 140px"}],e=w([]);function d(f){const p=e.value.find(c=>c.id===f);return p?p.project_type:"â"}async function I(){try{const{data:f}=await Q.get("/project-types");e.value=f}catch(f){T(f,"Failed to load project types")}}async function V(){_.value=!0;try{const f={};i.value&&(f.q=i.value);const{data:p}=await Q.get("/projects/admin",{params:f});y.value=p}catch(f){T(f,"Failed to load projects")}finally{_.value=!1}}const b=J({open:!1,mode:"create",id:null});function N(){b.open=!0,b.mode="create",b.id=null}function h(f){b.open=!0,b.mode="edit",b.id=f}async function k(){await V()}const o=w(!1),n=w(null),s=w(null);function F(f,p){n.value=f,s.value=p,o.value=!0}async function r(){await V()}const a=J({open:!1,id:null,loading:!1});function m(f){a.open=!0,a.id=f}async function j(){a.loading=!0;try{await Q.delete(`/projects/admin/${a.id}`),S.notify({type:"positive",message:"Deleted"}),a.open=!1,await V()}catch(f){T(f,"Failed to delete")}finally{a.loading=!1}}function T(f,p="Error"){const c=f?.response?.data?.error||f?.message||p;S.notify({type:"negative",message:c})}return de(async()=>{await I(),await V()}),(f,p)=>($(),z(je,{padding:""},{default:g(()=>[v("div",Ae,[p[5]||(p[5]=v("div",{class:"text-h6"},"Projects",-1)),t(te),t(D,{modelValue:i.value,"onUpdate:modelValue":[p[1]||(p[1]=c=>i.value=c),V],dense:"",outlined:"",debounce:"300",class:"q-mr-sm",style:{width:"260px"},placeholder:"Search title"},{prepend:g(()=>[t(be,{name:"search"})]),append:g(()=>[i.value?($(),z(C,{key:0,flat:"",round:"",dense:"",icon:"close",onClick:p[0]||(p[0]=c=>{i.value="",V()})})):L("",!0)]),_:1},8,["modelValue"]),t(C,{color:"primary",icon:"add",label:"New",onClick:N})]),t(_e,{rows:y.value,columns:q,"row-key":"id",flat:"",bordered:"",loading:_.value,pagination:{rowsPerPage:0},"no-data-label":"No projects yet","no-results-label":"No matches"},{"body-cell-project_type":g(c=>[t(G,{props:c},{default:g(()=>[v("span",null,O(d(c.row.project_type_id)),1)]),_:2},1032,["props"])]),"body-cell-status":g(c=>[t(G,{props:c},{default:g(()=>[A(O(c.row.status),1)]),_:2},1032,["props"])]),"body-cell-actions":g(c=>[t(G,{props:c,class:"q-gutter-xs"},{default:g(()=>[t(C,{dense:"",flat:"",round:"",icon:"image",onClick:B=>F(c.row.id,c.row.title)},null,8,["onClick"]),t(C,{dense:"",flat:"",round:"",icon:"edit",onClick:B=>h(c.row.id)},null,8,["onClick"]),t(C,{dense:"",flat:"",round:"",icon:"delete",color:"negative",onClick:B=>m(c.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"]),t(qe,{modelValue:b.open,"onUpdate:modelValue":p[2]||(p[2]=c=>b.open=c),mode:b.mode,"project-id":b.id,"type-options":e.value,onSaved:k},null,8,["modelValue","mode","project-id","type-options"]),t(Me,{modelValue:o.value,"onUpdate:modelValue":p[3]||(p[3]=c=>o.value=c),"project-id":n.value,"project-title":s.value,onChanged:r},null,8,["modelValue","project-id","project-title"]),t(le,{modelValue:a.open,"onUpdate:modelValue":p[4]||(p[4]=c=>a.open=c)},{default:g(()=>[t(H,null,{default:g(()=>[t(R,null,{default:g(()=>[...p[6]||(p[6]=[v("div",{class:"text-h6"},"Delete this project?",-1),v("div",{class:"text-body2 q-mt-xs"}," This will also remove its images. ",-1)])]),_:1}),t(ue,{align:"right"},{default:g(()=>[ee(t(C,{flat:"",label:"Cancel"},null,512),[[ae]]),t(C,{color:"negative",label:"Delete",loading:a.loading,onClick:j},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Ze as default};
