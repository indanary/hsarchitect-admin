import{m as U,r as f,n as M,p as O,q as z,s as G,v as K,x as L,y as H,z as F,A as J,B as W,C as X,d as Y,h as I,o as T,w as n,D as V,g as h,a as o,E as B,i as Z,Q as c,F as ee,G as q,t as te}from"./index-DDweDHnI.js";import{b as A,Q as N,a as k}from"./QCard-DSim-vQw.js";import{Q as ae,a as oe,b as $,C as D,c as R}from"./ClosePopup-D82EvVQ4.js";import{u as le,Q as ne}from"./use-quasar-DC3yOtG6.js";import{a as se}from"./focus-manager-DnPWlgXC.js";import{Q as re}from"./QPage-Bi2UGTBq.js";const ie=U({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(p,{slots:m,emit:b}){const C=G(),r=f(null);let v=0;const i=[];function x(l){const s=typeof l=="boolean"?l:p.noErrorFocus!==!0,g=++v,w=(e,a)=>{b(`validation${e===!0?"Success":"Error"}`,a)},Q=e=>{const a=e.validate();return typeof a.then=="function"?a.then(t=>({valid:t,comp:e}),t=>({valid:!1,comp:e,err:t})):Promise.resolve({valid:a,comp:e})};return(p.greedy===!0?Promise.all(i.map(Q)).then(e=>e.filter(a=>a.valid!==!0)):i.reduce((e,a)=>e.then(()=>Q(a).then(t=>{if(t.valid===!1)return Promise.reject(t)})),Promise.resolve()).catch(e=>[e])).then(e=>{if(e===void 0||e.length===0)return g===v&&w(!0),!0;if(g===v){const{comp:a,err:t}=e[0];if(t!==void 0&&console.error(t),w(!1,a),s===!0){const P=e.find(({comp:E})=>typeof E.focus=="function"&&H(E.$)===!1);P!==void 0&&P.comp.focus()}}return!1})}function u(){v++,i.forEach(l=>{typeof l.resetValidation=="function"&&l.resetValidation()})}function d(l){l!==void 0&&F(l);const s=v+1;x().then(g=>{s===v&&g===!0&&(p.onSubmit!==void 0?b("submit",l):l?.target!==void 0&&typeof l.target.submit=="function"&&l.target.submit())})}function y(l){l!==void 0&&F(l),b("reset"),J(()=>{u(),p.autofocus===!0&&p.noResetFocus!==!0&&j()})}function j(){se(()=>{if(r.value===null)return;(r.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||r.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||r.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(r.value.querySelectorAll("[tabindex]"),s=>s.tabIndex!==-1))?.focus({preventScroll:!0})})}W(X,{bindComponent(l){i.push(l)},unbindComponent(l){const s=i.indexOf(l);s!==-1&&i.splice(s,1)}});let _=!1;return M(()=>{_=!0}),O(()=>{_===!0&&p.autofocus===!0&&j()}),z(()=>{p.autofocus===!0&&j()}),Object.assign(C.proxy,{validate:x,resetValidation:u,submit:d,reset:y,focus:j,getValidationComponents:()=>i}),()=>K("form",{class:"q-form",ref:r,onSubmit:d,onReset:y},L(m.default))}}),ue={class:"row items-center q-mb-md"},de={class:"text-h6"},ge=Y({__name:"ProjectTypesPage",setup(p){const m=le(),b=f(!1),C=f([]),r=f(""),v=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"project_type",label:"Project Type",field:"project_type",align:"left",sortable:!0},{name:"actions",label:"",field:"actions",align:"right"}];async function i(){b.value=!0;try{const{data:e}=await V.get("/project-types",{params:r.value?{q:r.value}:void 0});C.value=e}catch(e){S(e,"Failed to load project types")}finally{b.value=!1}}function x(){r.value="",i()}const u=f({open:!1,mode:"create",editingId:null}),d=f({project_type:""}),y=f(!1);function j(){u.value={open:!0,mode:"create",editingId:null},d.value={project_type:""}}function _(e){u.value={open:!0,mode:"edit",editingId:e.id},d.value={project_type:e.project_type}}async function l(){if(!d.value.project_type?.trim()){m.notify({type:"warning",message:"Project type is required"});return}y.value=!0;try{u.value.mode==="create"?(await V.post("/project-types",{project_type:d.value.project_type.trim()}),m.notify({type:"positive",message:"Created"})):(await V.patch(`/project-types/${u.value.editingId}`,{project_type:d.value.project_type.trim()}),m.notify({type:"positive",message:"Saved"})),u.value.open=!1,await i()}catch(e){e?.response?.status===409?m.notify({type:"negative",message:"That project type already exists"}):S(e,"Failed to save")}finally{y.value=!1}}const s=f({open:!1,id:null}),g=f(!1);function w(e){s.value={open:!0,id:e.id}}async function Q(){g.value=!0;try{await V.delete(`/project-types/${s.value.id}`),m.notify({type:"positive",message:"Deleted"}),s.value.open=!1,await i()}catch(e){S(e,"Failed to delete")}finally{g.value=!1}}function S(e,a="Error"){const t=e?.response?.data?.error||e?.message||a;m.notify({type:"negative",message:t})}return i(),(e,a)=>(T(),I(re,{padding:""},{default:n(()=>[h("div",ue,[a[4]||(a[4]=h("div",{class:"text-h6"},"Project Types",-1)),o(B),o(A,{modelValue:r.value,"onUpdate:modelValue":[a[0]||(a[0]=t=>r.value=t),i],dense:"",outlined:"",debounce:"300",placeholder:"Search project typesâ€¦",style:{width:"260px"}},{prepend:n(()=>[o(ee,{name:"search"})]),append:n(()=>[r.value?(T(),I(c,{key:0,flat:"",round:"",dense:"",icon:"close",onClick:x})):Z("",!0)]),_:1},8,["modelValue"]),o(c,{color:"primary",class:"q-ml-sm",icon:"add",label:"New",onClick:j})]),o(ae,{rows:C.value,columns:v,"row-key":"id",flat:"",bordered:"",loading:b.value,pagination:{rowsPerPage:0},"no-data-label":"No project types yet","no-results-label":"No matches"},{"body-cell-actions":n(t=>[o(oe,{props:t,class:"q-gutter-xs"},{default:n(()=>[o(c,{dense:"",flat:"",round:"",icon:"edit",onClick:P=>_(t.row)},null,8,["onClick"]),o(c,{dense:"",flat:"",round:"",icon:"delete",color:"negative",onClick:P=>w(t.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"]),o($,{modelValue:u.value.open,"onUpdate:modelValue":a[2]||(a[2]=t=>u.value.open=t),persistent:""},{default:n(()=>[o(N,{style:{"min-width":"420px"}},{default:n(()=>[o(k,{class:"row items-center"},{default:n(()=>[h("div",de,te(u.value.mode==="create"?"New Project Type":"Edit Project Type"),1),o(B),q(o(c,{icon:"close",flat:"",round:"",dense:""},null,512),[[D]])]),_:1}),o(ne),o(k,null,{default:n(()=>[o(ie,{onSubmit:l},{default:n(()=>[o(A,{modelValue:d.value.project_type,"onUpdate:modelValue":a[1]||(a[1]=t=>d.value.project_type=t),label:"Project type *",outlined:"",rules:[t=>!!t&&t.trim().length>0||"Required",t=>(t?.length??0)<=120||"Max 120 chars"],autofocus:"",disable:y.value},null,8,["modelValue","rules","disable"])]),_:1})]),_:1}),o(R,{align:"right"},{default:n(()=>[q(o(c,{flat:"",label:"Cancel",disable:y.value},null,8,["disable"]),[[D]]),o(c,{color:"primary",loading:y.value,label:u.value.mode==="create"?"Create":"Save",onClick:l},null,8,["loading","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o($,{modelValue:s.value.open,"onUpdate:modelValue":a[3]||(a[3]=t=>s.value.open=t)},{default:n(()=>[o(N,null,{default:n(()=>[o(k,null,{default:n(()=>[...a[5]||(a[5]=[h("div",{class:"text-h6"},"Delete project type?",-1),h("div",{class:"text-body2 q-mt-xs"},"This action cannot be undone.",-1)])]),_:1}),o(R,{align:"right"},{default:n(()=>[q(o(c,{flat:"",label:"Cancel"},null,512),[[D]]),o(c,{color:"negative",label:"Delete",loading:g.value,onClick:Q},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ge as default};
